function disp(n,e){return e?n.toPrecision(CONST.displayPrecision):Number(n.toPrecision(CONST.displayPrecision))}function doTransition(){document.body.classList.remove("scene-falling","scene-boat"),document.body.classList.add("scene-transitioning"),n2l.active.cleanUp(),n2l.active=n2l[["falling","boat"][n2l.scene]],n2l.active.velocity=0,["force","mass","accel"].forEach(function(n){n2l.$[n].classList.remove("can-edit")}),n2l.active.dynamic.forEach(function(n){n2l.$[n].classList.add("can-edit")}),n2l.active.init(),document.body.classList.remove("scene-transitioning"),document.body.classList.add("scene-"+["falling","boat"][n2l.scene])}function draw(){requestAnimationFrame(draw),n2l.timing["this"]=Date.now(),n2l.timing.delta=n2l.timing["this"]-n2l.timing.last,n2l.timing.last=n2l.timing["this"],n2l.timing.fps=1e3/n2l.timing.delta;var n=(49*n2l.timing.runningFPS+n2l.timing.fps)/50;n!==n2l.timing.runningFPS&&(n2l.timing.runningFPS=n,document.getElementById("fps").innerText=Math.floor(n)),n2l.active.draw(),n2l.active.velocity+=n2l.active.fma.acceleration*n2l.timing.delta*.001,n2l.updateDisplays()}var CONST={densityAir:1.225,sailArea:7.5,accelGravity:9.8,displayPrecision:4,wstroke:{lengthCoeff:1,speedCoeff:1}},n2l={},WindStroke=function(n){this.direction=n,this.position=new Ph.Vector2,this.position.x=Math.random()*n2l.stage.width,this.position.y=Math.random()*n2l.stage.height,this.offscreen=!1};WindStroke.prototype.draw=function(){this.offscreen&&(this.offscreen=!1);var n=n2l.ctx;n.beginPath(),n.moveTo(this.position.x,this.position.y),this.direction?n.lineTo(this.position.x-10*CONST.wstroke.lengthCoeff*n2l.boat.windSpeed,this.position.y):n.lineTo(this.position.x,this.position.y+CONST.wstroke.lengthCoeff*n2l.active.velocity),n.strokeStyle="rgba(255, 255, 255, 0.25)",n.lineCap="round",n.lineWidth=Math.max(0,4-.01*n2l.active.velocity),n.stroke(),this.direction?(this.position.x+=5*CONST.wstroke.speedCoeff*n2l.boat.windSpeed,this.position.x-10*CONST.wstroke.lengthCoeff*n2l.boat.windSpeed>n2l.stage.width&&(this.offscreen=!0,this.position.x-=(1+Math.random())*n2l.stage.width,this.position.y=Math.random()*n2l.stage.height)):(this.position.y-=CONST.wstroke.speedCoeff*n2l.active.velocity,this.position.y+CONST.wstroke.lengthCoeff*n2l.active.velocity<0&&(this.offscreen=!0,this.position.x=Math.random()*n2l.stage.width,this.position.y+=(1+Math.random())*n2l.stage.height))},n2l.$stage=document.getElementById("stage"),n2l.stage={width:0,height:0,mouse:{x:0,y:0}},n2l.$canvas=document.getElementById("c"),n2l.ctx=n2l.$canvas.getContext("2d"),n2l.ctx.globalCompositeOperation="destination-atop",n2l.windStrokes=[],n2l.falling={velocity:0},n2l.falling.fma=new Ph.FMARelationship,n2l.falling.fma.getForce({mass:1,acceleration:CONST.accelGravity},!0),n2l.falling.dynamic=["mass"],n2l.falling.find="getForce",n2l.falling.range={mass:{max:3e3,min:.1}},n2l.falling.imageStates=["marble","brick","bowling ball","anvil","piano","rhino"],function(){n2l.falling.imageStates.forEach(function(n){var e=document.createElement("img");e.style.transform="translate(-9999px, -9999px)",e.onload=e.onerror=function(){this.remove()},n2l.$stage.appendChild(e),e.src="/n2l/assets/falling/"+n.replace(" ","-")+".png"}),n2l.falling.$img=document.createElement("img"),n2l.falling.$img.style.transform="translate(-9999px, -9999px)",n2l.$stage.appendChild(n2l.falling.$img),n2l.falling.init=function(){n2l.windStrokes.forEach(function(n){n.direction=0})},n2l.falling.rot=new Ph.DVASystem2(0,0,0,0,0,0),n2l.falling.lastImage="",n2l.falling.draw=function(){n2l.falling.rot.acceleration.x+=.01*(.5-Math.random()),Math.abs(n2l.falling.rot.velocity.x)>2&&(n2l.falling.rot.acceleration.x-=.02*Math.sign(n2l.falling.rot.velocity.x),n2l.falling.rot.acceleration.x*=.25);var n=n2l.falling.fma.mass,e=n2l.falling.getMassType(n).replace(" ","-");e!==n2l.falling.lastImage&&(n2l.falling.$img.src="/n2l/assets/falling/"+e+".png",n2l.falling.lastImage=e),n2l.falling.rot.tick();var t=n2l.falling.rot.displacement.x,i=1+.2*Math.log10(n2l.falling.fma.mass);n2l.falling.$img.style.transform="scale("+i+") rotate("+t+"deg) ",n2l.ctx.clearRect(0,0,n2l.stage.width,n2l.stage.height),n2l.windStrokes.forEach(function(n){n.draw()})},n2l.falling.cleanUp=function(){n2l.falling.$img.style.transform="translate(-9999px, -9999px)"}}(),n2l.falling.getMassNumber=function(n){var e=0;return n>=.5&&e++,n>=4&&e++,n>=10&&e++,n>=200&&e++,n>=1e3&&e++,e},n2l.falling.getMassType=function(n){return n2l.falling.imageStates[n2l.falling.getMassNumber(n)]},n2l.boat={velocity:0},n2l.boat.fma=new Ph.FMARelationship,n2l.boat.fma.getAcceleration({mass:2e3,force:1*CONST.densityAir*CONST.sailArea},!0),n2l.boat.dynamic=["force","mass"],n2l.boat.find="getAcceleration",n2l.boat.range={force:{min:.1*.1*CONST.densityAir*CONST.sailArea,max:1072.5625*CONST.densityAir*CONST.sailArea},mass:{min:1800,max:3600}},function(){n2l.boat.init=function(){n2l.windStrokes.forEach(function(n){n.direction=1})},n2l.boat.draw=function(){n2l.boat.windSpeed=Math.sqrt(n2l.active.fma.force/(CONST.densityAir*CONST.sailArea)),n2l.ctx.clearRect(0,0,n2l.stage.width,n2l.stage.height),n2l.windStrokes.forEach(function(n){n.draw()})},n2l.boat.cleanUp=function(){}}(),n2l.boat.getBeaufortNumber=function(n){var e=0;return n>=.278&&e++,n>=1.667&&e++,n>=3.333&&e++,n>=5.556&&e++,n>=8.056&&e++,n>=10.83&&e++,n>=13.89&&e++,n>=17.22&&e++,n>=20.83&&e++,n>=24.72&&e++,n>=28.61&&e++,n>=32.5&&e++,e},n2l.boat.getBeaufortDesc=function(n){return["calm","light air","light breeze","gentle breeze","moderate breeze","fresh breeze","strong breeze","near gale","gale","strong gale","storm","violent storm","hurricane"][n]},window.addEventListener("mousemove",function(n){n2l.stage.mouse.x=n.clientX,n2l.stage.mouse.y=n.clientY}),window.addEventListener("resize",function n(){return n2l.$canvas.width=n2l.stage.width=window.innerWidth,n2l.$canvas.height=n2l.stage.height=window.innerHeight,n}()),function(){}(Util),n2l.scene=0,n2l.active=n2l.falling,function e(){n2l.$sceneToggle=document.getElementById("scene-toggle"),n2l.$sceneToggle.addEventListener("click",function(){n2l.scene=1^n2l.scene,doTransition()})}(),function t(){n2l.$={},n2l.$.ws={},n2l.$.ws.beaufortNumber=document.getElementById("ws-beaufort"),n2l.$.ws.beaufortDescription=document.getElementById("ws-description"),n2l.$.ws.value=document.getElementById("ws-value"),n2l.$.force=document.getElementById("value-force"),n2l.$.mass=document.getElementById("value-mass"),n2l.$.massType=document.getElementById("type-mass"),n2l.$.accel=n2l.$.acceleration=document.getElementById("value-accel"),n2l.$.velocity=document.getElementById("vel-value"),n2l.$.velocityReset=document.getElementById("vel-reset"),n2l.$.velocityReset.addEventListener("click",function(){n2l.active.velocity=0}),n2l.updateDisplays=function(){if(1===n2l.scene){var n=Math.sqrt(n2l.active.fma.force/(CONST.densityAir*CONST.sailArea));n2l.boat.windSpeed=n;var e=n2l.boat.getBeaufortNumber(n);n2l.$.ws.beaufortNumber.innerText=e,n2l.$.ws.beaufortDescription.innerText=n2l.boat.getBeaufortDesc(e),n2l.$.ws.value.innerText=disp(n),n2l.$.massType.innerText=""}else n2l.$.massType.innerText=n2l.falling.getMassType(n2l.active.fma.mass);n2l.$.force.innerText=disp(n2l.active.fma.force),n2l.$.mass.innerText=disp(n2l.active.fma.mass),n2l.$.accel.innerText=disp(n2l.active.fma.acceleration),n2l.$.velocity.innerText=disp(n2l.active.velocity,1)},n2l.changing="",n2l.changingStartX=0,n2l.changingStart=0,["force","mass","acceleration"].forEach(function(n){n2l.$[n].addEventListener("mousedown",function(){this.classList.contains("can-edit")&&(n2l.changing=n,n2l.changingStart=n2l.active.fma[n])})}),document.body.addEventListener("mouseup",function(){n2l.changing=""}),document.body.addEventListener("mousemove",function(n){if(n2l.changing){var e=Math.exp(8*(n.clientX-n2l.changingStartX)/n2l.stage.width);n2l.active.fma[n2l.active.find](function(n){return n[n2l.changing]=Math.max(Math.min(e*n2l.changingStart,n2l.active.range[n2l.changing].max),n2l.active.range[n2l.changing].min),n}({}),!0)}else n2l.changingStartX=n.clientX})}();for(var i=1e3;i>=0;i--)n2l.windStrokes.push(new WindStroke(0));n2l.timing={},n2l.timing.last=Date.now(),n2l.timing.runningFPS=60,doTransition(),requestAnimationFrame(draw);
//# sourceMappingURL=./n2l.min.js.map